// Wykies Automation public site — local fallback rendering (relative paths)
const CONTACT = { whatsappIntl: "27716816131", email: "wykiesautomation@gmail.com" };
function toRand(v){ return `R${Number(v).toFixed(2)}`; }
function qs(sel){ return document.querySelector(sel); }
function param(name){ return new URLSearchParams(location.search).get(name); }
const PRODUCTS_LOCAL = [
  {sku:'WA-01', name:'GSM Gate Controller', price:1499, summary:'Remote control via GSM/Wi‑Fi', active:true, category:'Control Systems', stock:0},
  {sku:'WA-02', name:'Plasma Cutter Control', price:2499, summary:'THC & cut job management', active:true, category:'Industrial', stock:0},
  {sku:'WA-03', name:'ECU/TCU Control System', price:6499, summary:'Automotive ECU/TCU GUI', active:true, category:'Automotive', stock:0}
];
function imgPaths(sku){ const b = sku.toLowerCase(); return { png:`assets/img/products/${b}.png`, webp:`assets/img/products/${b}.webp`, tpng:`assets/img/products/${b}-thumb.png`, twebp:`assets/img/products/${b}-thumb.webp` }; }
function pictureHTML(p, alt, useThumb=false){ const {png,webp,tpng,twebp} = imgPaths(p.sku); const imgPng = useThumb?tpng:png; const imgWebp = useThumb?twebp:webp; return `<picture>\n <source srcset="${imgWebp}" type="image/webp">\n <img src="${imgPng}" alt="${alt}" loading="lazy">\n</picture>`; }
function renderProductCards(products){ const grid=qs('#productGrid'); if(!grid) return; grid.innerHTML=products.filter(p=>p.active).map(p=>`<article class="card">${pictureHTML(p,p.name,true)}<div class="body"><h3>${p.name}</h3><p class="muted">${p.summary||''}</p><div class="row"><span class="price">${toRand(p.price)}</span>${p.stock>0?`<span class="badge ok">In Stock</span>`:`<span class="badge warn">Pre‑Order</span>`}</div><div class="row" style="margin-top:8px;"><a class="btn" href="products/product.html?sku=${encodeURIComponent(p.sku)}">View Details</a><a class="btn btn-outline" target="_blank" rel="noopener" href="docs/${encodeURIComponent(p.sku)}.pdf">View Docs</a></div></div></article>`).join(''); }
function renderGalleryPreview(products){ const grid=qs('#galleryPreview'); if(!grid) return; const items=[]; products.forEach(p=>items.push({p,alt:p.name})); grid.innerHTML=items.slice(0,8).map(g=>`<figure class="card">${pictureHTML(g.p,g.alt,true)}<figcaption class="body">${g.alt}</figcaption></figure>`).join(''); }
async function renderProductPage(products){ const el=qs('#product'); if(!el) return; const sku=param('sku')||products[0].sku; const p=products.find(x=>x.sku===sku)||products[0]; const waUrl=`https://wa.me/${CONTACT.whatsappIntl}?text=${encodeURIComponent(`Hi, I'm interested in ${p.sku} — ${p.name}`)}`; el.innerHTML=`<section class="product-wrap"><div>${pictureHTML(p,p.name,false)}<div class="product-gallery" style="margin-top:12px;">${pictureHTML(p,`${p.name} thumbnail`,true)}</div></div><div><h2>${p.sku} — ${p.name}</h2><p class="badge">${p.category||'Product'}</p><p>${p.summary||''}</p><p><strong class="price">${toRand(p.price)}</strong> (VAT incl.)</p><div style="display:flex;gap:8px;flex-wrap:wrap;"><a class="btn" target="_blank" rel="noopener" href="${waUrl}">WhatsApp</a><a class="btn btn-outline" href="../docs/${encodeURIComponent(p.sku)}.pdf">View Docs</a></div></div></section>`; }
function wireNav(){ const waUrl=`https://wa.me/${CONTACT.whatsappIntl}?text=${encodeURIComponent('Hello Wykies Automation — I am interested')}`; ['#navWhatsApp','#heroWhatsApp','#footerWhatsApp'].forEach(sel=>{ const el=qs(sel); if(el) el.setAttribute('href', waUrl); }); }
(function init(){ wireNav(); const products=PRODUCTS_LOCAL; renderProductCards(products); renderGalleryPreview(products); renderProductPage(products); })();
