const cfg = (async ()=> await (await fetch('/config.json')).json())(); let token = null; async function adminLogin(){ const pass = document.getElementById('passphrase').value; const c = await cfg; const res = await fetch(`${c.APP_SCRIPT_BASE}?route=adminLogin`,{method:'POST',body:JSON.stringify({pass})}); const data = await res.json(); if(data.ok){ token=data.token; document.getElementById('login').style.display='none'; document.getElementById('adminPanel').style.display='block'; loadAdmin(); } else alert('Invalid passphrase'); } async function loadAdmin(){ const c = await cfg; const products = await (await fetch(`${c.APP_SCRIPT_BASE}?route=products`)).json(); const wrap = document.getElementById('adminProducts'); wrap.innerHTML=''; products.products.forEach(p=>{ const div = document.createElement('div'); div.className='card'; div.innerHTML = ` <h3>${p.sku} â€“ ${p.name}</h3> <label>Price</label><input class="input" id="pr_${p.sku}" value="${p.price}"> <label>Image URL</label><input class="input" id="im_${p.sku}" value="${p.imageUrl||''}"> <label>Doc URL</label><input class="input" id="doc_${p.sku}" value="${p.docUrl||''}"> <label>Trial URL</label><input class="input" id="trial_${p.sku}" value="${p.trialUrl||''}"> <div class="btnrow"><button class="btn" onclick="saveProduct('${p.sku}')">Save</button></div>`; wrap.appendChild(div); }); const gwrap = document.getElementById('adminGallery'); const gal = await (await fetch(`${c.APP_SCRIPT_BASE}?route=gallery`)).json(); gwrap.innerHTML = ''; gal.images.forEach((g,i)=>{ const div = document.createElement('div'); div.className='card'; div.innerHTML = `<label>Image URL</label><input class="input" id="gim_${i}" value="${g.imageUrl}"><label>Caption</label><input class="input" id="gcap_${i}" value="${g.caption||''}"><div class="btnrow"><button class="btn" onclick="saveGallery(${i})">Save</button></div>`; gwrap.appendChild(div); }) } async function saveProduct(sku){ const c = await cfg; const payload = {token, sku, price: document.getElementById('pr_'+sku).value, imageUrl: document.getElementById('im_'+sku).value, docUrl: document.getElementById('doc_'+sku).value, trialUrl: document.getElementById('trial_'+sku).value}; const res = await fetch(`${c.APP_SCRIPT_BASE}?route=saveProduct`,{method:'POST',body:JSON.stringify(payload)}); const ok = await res.json(); alert(ok.status||'Saved'); } async function saveGallery(i){ const c = await cfg; const payload = {token, index:i, imageUrl: document.getElementById('gim_'+i).value, caption: document.getElementById('gcap_'+i).value}; const res = await fetch(`${c.APP_SCRIPT_BASE}?route=saveGallery`,{method:'POST',body:JSON.stringify(payload)}); const ok = await res.json(); alert(ok.status||'Saved'); }