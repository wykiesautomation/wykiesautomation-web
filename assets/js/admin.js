let authed=false;async function adminLogin(){const pass=document.getElementById('pass').value;if(pass==='Ford@20132016'){authed=true;document.getElementById('authStatus').textContent='Unlocked';document.getElementById('adminArea').style.display='block';loadEditor()}else{document.getElementById('authStatus').textContent='Wrong passphrase'}}async function loadEditor(){const cfg=await (await fetch('config.json')).json();const res=await fetch(cfg.appsScriptUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({kind:'get-products','X-Auth':cfg.xAuthToken})});const payload=await res.json();const items=payload.data||[];const el=document.getElementById('productEditor');el.innerHTML=items.map(p=>`<article class=card><div class=content><h3>${p.id} â€” ${p.name}</h3><label>Name <input value='${p.name}' onchange="editById('${p.id}','name',this.value)"></label><br><label>Price <input value='${p.price}' onchange="editById('${p.id}','price',this.value)"></label><br><label>Image URL <input value='${p.image}' onchange="editById('${p.id}','image',this.value)"></label><br><label>Summary <textarea onchange="editById('${p.id}','summary',this.value)">${p.summary}</textarea></label><br></div></article>`).join('')}async function addProduct(){if(!authed){document.getElementById('addStatus').textContent='Unlock admin first';return}const id=document.getElementById('nSku').value.trim();const name=document.getElementById('nName').value.trim();const price=document.getElementById('nPrice').value.trim();const image=document.getElementById('nImage').value.trim();const summary=document.getElementById('nDesc').value.trim();if(!id||!name||!price||!image){document.getElementById('addStatus').textContent='Please fill id, name, price, image';return}const cfg=await (await fetch('config.json')).json();const payload={kind:'add-product','X-Auth':cfg.xAuthToken,id,name,summary,price,image};try{const res=await fetch(cfg.appsScriptUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});document.getElementById('addStatus').textContent=res.ok?'Product added':'Add failed';if(res.ok){loadEditor()}}catch(e){document.getElementById('addStatus').textContent='Add failed'}}async function editById(id,key,val){const cfg=await (await fetch('config.json')).json();const payload={kind:'update-product','X-Auth':cfg.xAuthToken,id,key,val};try{const res=await fetch(cfg.appsScriptUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});document.getElementById('saveStatus').textContent=res.ok?'Saved to CMS':'Save failed'}catch(e){document.getElementById('saveStatus').textContent='Save failed'}}async function addGallery(){const cfg=await (await fetch('config.json')).json();const payload={kind:'add-gallery','X-Auth':cfg.xAuthToken,url:document.getElementById('gUrl').value,title:document.getElementById('gTitle').value,sku:document.getElementById('gSku').value};try{const res=await fetch(cfg.appsScriptUrl,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify(payload)});document.getElementById('saveStatus').textContent=res.ok?'Gallery image added':'Add failed'}catch(e){document.getElementById('saveStatus').textContent='Add failed'}}