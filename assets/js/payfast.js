
async function loadConfig(){ const r = await fetch('config.json'); return await r.json(); }
async function payfastCheckout(sku){ const cfg = await loadConfig(); let products; try{ const rp = await fetch('data/products.json'); products = await rp.json(); }catch(e){ products = []; } const prod = products.find(p=>p.sku===sku); if(!prod){ alert('Product not found'); return; } const amount = Number(prod.price).toFixed(2); const item_name = prod.name; const endpoint = cfg.payfast.env==='sandbox' ? 'https://sandbox.payfast.co.za/eng/process' : 'https://www.payfast.co.za/eng/process'; const form = document.createElement('form'); form.method='post'; form.action=endpoint; const fields = { merchant_id: cfg.payfast.merchant_id, merchant_key: cfg.payfast.merchant_key, amount: amount, item_name: item_name, item_description: sku, return_url: cfg.payfast.return_url, cancel_url: cfg.payfast.cancel_url, notify_url: cfg.payfast.notify_url, email_address: '' }; for(const k in fields){ const inp=document.createElement('input'); inp.type='hidden'; inp.name=k; inp.value=fields[k]; form.appendChild(inp);} document.body.appendChild(form); form.submit(); }
