<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Product — Wykies Automation</title>
  <link rel="stylesheet" href="./assets/css/styles.css">
</head>
<body>
<header>
  <div class="wrap logo">
    <img src="./assets/img/logo-blue.svg" alt="Wykies Automation">
    <span class="h1">Wykies Automation — Product</span>
  </div>
  <div class="wrap"><nav>
    <a href="index.html">Home</a>
    <a href="gallery.html">Gallery</a>
    <a href="admin.html">Admin</a>
  </nav></div>
</header>
<main>
  <div class="wrap">
    <div id="prod"></div>
  </div>
</main>
<footer>
  <div class="wrap">© 2025 Wykies Automation • VAT included • Contact: <a href="mailto:wykiesautomation@gmail.com">wykiesautomation@gmail.com</a> • WhatsApp: <a id="wa-foot" target="_blank">Chat</a></div>
</footer>
<script type="module">
  import { qs } from './assets/js/ui.js';
  import { CFG, fetchProducts, initNav } from './assets/js/cms.js';
  import { redirectToPayFast } from './assets/js/payfast.js';

  function tpl(p){
    return `
    <div class="card">
      <img src="${p.imageUrl||'./assets/img/placeholder.jpg'}" alt="${p.name}">
      <div class="pad">
        <h2>${p.name} <span class="price">${p.price}</span></h2>
        <p>${p.description||p.summary||''}</p>
        <div class="btn-row">
          <a class="btn ghost" href="${p.trialUrl||'#'}" target="_blank">Trial</a>
          <a class="btn ghost" href="${p.docUrl||'#'}" target="_blank">Docs</a>
          <button class="btn primary" id="buy">Buy via PayFast</button>
        </div>
      </div>
    </div>`;
  }

  async function render(){
    await initNav();
    const params = new URLSearchParams(location.search);
    const sku = params.get('sku');
    const prods = await fetchProducts();
    const p = prods.find(x=>x.sku===sku) || prods[0];
    qs('#prod').innerHTML = tpl(p);
    qs('#wa-foot').href = `https://wa.me/${CFG.contact.whatsapp_number}`;
    qs('#buy').addEventListener('click', ()=>{
      const amount = String(p.price).replace(/[^0-9.]/g,'');
      redirectToPayFast({ sku:p.sku, name:p.name, amount, buyerEmail:'' });
    });
  }
  render();
</script>
</body>
</html>