
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Product</title>
  <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' data:; script-src 'self'; style-src 'self' 'unsafe-inline'; frame-ancestors 'none'; upgrade-insecure-requests">
  <link rel="stylesheet" href="assets/css/styles.css">
</head>
<body>
<header>
  <nav class="nav">
    <img src="assets/img/logo-blue.svg" alt="Wykies Automation logo">
    <a href="index.html">Home</a>
    <a href="gallery.html">Gallery</a>
    <div class="spacer"></div>
  </nav>
</header>
<main class="main">
  <div id="prod"></div>
</main>
<footer class="footer"><div class="main">&copy; <span id="year"></span> Wykies Automation</div></footer>
<script src="assets/js/app.js"></script>
<script>
(async function(){
  const params = new URLSearchParams(location.search);
  const sku = params.get('sku');
  const cfg = await fetch('config.json').then(r=>r.json());
  let products;
  try {
    const url = cfg.appsScriptUrl + '?action=products&sheetId=' + encodeURIComponent(cfg.sheetId);
    const res = await fetch(url);
    products = await res.json();
  } catch(e){
    products = await fetch('assets/js/products.json').then(r=>r.json());
  }
  const p = products.find(x=>x.sku===sku) || products[0];
  const el = document.getElementById('prod');
  el.innerHTML = `
    <div style="display:grid;grid-template-columns:1fr 1fr;gap:16px">
      <img src="${p.imageUrl}" alt="${p.name}" style="width:100%;border-radius:12px">
      <div>
        <h1>${p.name}</h1>
        <div class="price">R${p.price.toLocaleString('en-ZA')}</div>
        <p>${p.description||''}</p>
        <div style="display:flex;gap:8px;margin-top:12px">
          <button class="btn" onclick="initCheckout('${p.sku}')">Buy with PayFast</button>
          <a class="btn secondary" href="https://wa.me/27716816131?text=I%20am%20interested%20in%20${encodeURIComponent(p.sku)}" target="_blank" rel="noopener">WhatsApp</a>
        </div>
      </div>
    </div>
  `;
  document.getElementById('year').textContent = new Date().getFullYear();
})();
</script>
</body>
</html>
